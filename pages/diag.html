<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diagnostics</title>
<style>body{background:#0e0b14;color:#e8e5f0;font-family:system-ui,Segoe UI,Inter,Arial;margin:0;padding:20px}
.card{background:#171326;border:1px solid #2a2540;border-radius:16px;padding:16px;margin-bottom:16px} button{background:#1c1828;color:#e8e5f0;border:1px solid #2a2540;border-radius:10px;padding:8px 12px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px} th,td{border:1px solid #2a2540;padding:6px 8px;font-size:14px}</style>
</head><body>
<h1>Diagnostics</h1>
<div class="card"><button id="run">Run Checks</button> <button id="clr">Clear local override</button><div id="log" style="margin-top:10px;font-family:ui-monospace,Menlo,monospace"></div></div>
<div class="card"><h3>VRM Paths</h3><div id="table"></div></div>
<script type="module">
const log=(...a)=>{ document.getElementById('log').innerHTML += a.join(' ')+'<br/>'; };
async function getCfg(){
  const local=localStorage.getItem('ct.models.json'); if(local){ log('Using local override (ct.models.json)'); return JSON.parse(local); }
  const tries=['../../data/models.json','../data/models.json','./data/models.json'];
  for (const u of tries){ try{ const r=await fetch(u,{cache:'no-store'}); if(r.ok){ log('Loaded',u); return await r.json(); } }catch{} }
  throw new Error('models.json not found');
}
async function head(url){ try{ const r=await fetch(url,{headers:{Range:'bytes=0-64'}}); return r.ok?'OK':('ERR '+r.status); }catch(e){ return 'ERR'; } }
document.getElementById('run').onclick=async()=>{
  document.getElementById('log').innerHTML='';
  try{
    const cfg=await getCfg(); const rows=[['Character','vrm','Status']];
    for(const ch of cfg.characters){ const abs=new URL(ch.vrm, location.href).href; const st=await head(abs); rows.push([ch.name,ch.vrm,st]); }
    const html='<table>'+rows.map((r,i)=>'<tr>'+r.map(c=> (i?'<td>':'<th>')+c+'</'+(i?'td':'th')+'>').join('')+'</tr>').join('')+'</table>';
    document.getElementById('table').innerHTML=html;
  }catch(e){ log('ERROR:', e.message||String(e)); }
};
document.getElementById('clr').onclick=()=>{ localStorage.removeItem('ct.models.json'); alert('Cleared. Reload and run again.'); };
</script>
</body></html>

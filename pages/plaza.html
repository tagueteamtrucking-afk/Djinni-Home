<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plaza — Load Many</title>
<link rel="stylesheet" href="../asset/css/town.css"/></head><body>
<div class="topbar"><a href="../index.html">← Town</a><strong>Plaza</strong><a href="./wings-room.html">Wing Room</a></div>
<div class="spacer"></div><div class="container">
<div class="flex"><button class="btn" id="loadAll">Load All Characters</button><button class="btn" id="clear">Clear</button></div>
<canvas id="scene"></canvas></div>
<script type="module">
import * as THREE from "https://unpkg.com/three@0.152.2/build/three.module.js"; import { OrbitControls } from "https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js"; import { GLTFLoader } from "https://unpkg.com/three@0.152.2/examples/jsm/loaders/GLTFLoader.js"; import * as VRM from "https://unpkg.com/@pixiv/three-vrm@3.2.0/lib/three-vrm.module.js";
import { loadModelsConfig, loadVRMWithWings, addLights, fitOrbitToScene } from "../asset/js/vrm-utils.js";
const canvas=document.getElementById('scene'); const renderer=new THREE.WebGLRenderer({canvas,antialias:true}); renderer.setPixelRatio(devicePixelRatio); renderer.setSize(canvas.clientWidth,canvas.clientHeight);
const scene=new THREE.Scene(); scene.background=new THREE.Color(0x0c0a12);
const camera=new THREE.PerspectiveCamera(45,canvas.clientWidth/canvas.clientHeight,.1,100); camera.position.set(0,1.4,3); const controls=new OrbitControls(camera,renderer.domElement); addLights(scene);
const clock=new THREE.Clock(); const mixers=[];
addEventListener('resize',()=>{renderer.setSize(canvas.clientWidth,canvas.clientHeight);camera.aspect=canvas.clientWidth/canvas.clientHeight;camera.updateProjectionMatrix();});
async function loadAll(){ const cfg=await loadModelsConfig(); let x=-Math.floor(cfg.characters.length/2)*0.7; for(const ch of cfg.characters){ const obj=await loadVRMWithWings(ch.vrm,ch.wings); obj.group.position.set(x,0,0); x+=0.7; scene.add(obj.group); if(obj.mixer)mixers.push(obj.mixer); } fitOrbitToScene(controls,scene);}
document.getElementById('loadAll').onclick=loadAll; document.getElementById('clear').onclick=()=>{while(scene.children.length) scene.remove(scene.children[0]);};
(function anim(){requestAnimationFrame(anim); const dt=clock.getDelta(); mixers.forEach(m=>m.update(dt)); renderer.render(scene,camera);})();
</script></body></html>